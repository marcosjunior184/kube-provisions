apiVersion: v1
kind: ConfigMap
metadata:
  name: caddy-config
  namespace: proxy
data:
  Caddyfile: |
  
    :80 {
    
      # Handle A.local - Application A
      handle Host(`casaos.local`) {
        reverse_proxy 192.168.8.221:80 {
          header_up X-Forwarded-Host {host}
          header_up X-Real-IP {remote}
        }
      }
      
      # Handle B.local - Application B
      handle Host(`net.local`) {
        reverse_proxy 192.168.8.1:80 {
          header_up X-Forwarded-Host {host}
          header_up X-Real-IP {remote}
        }
      }
      
      # Handle C.local - Application C
      handle Host(`proxmox.local`) {
        reverse_proxy 192.168.8.220:8006 {
          header_up X-Forwarded-Host {host}
          header_up X-Real-IP {remote}
        }
      }
      
      # Default response for unknown hosts
      handle {
        respond "Unknown host: {host}. Available: A.local, B.local, C.local" 404
      }
    }

---

# caddy-complete.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: caddy
  namespace: proxy
spec:
  replicas: 2
  selector:
    matchLabels:
      app: caddy
  template:
    metadata:
      labels:
        app: caddy
    spec:
      containers:
      - name: caddy
        image: caddy:2-alpine
        ports:
        - containerPort: 80
        volumeMounts:
        - name: caddy-config
          mountPath: /etc/caddy
        args: 
          - "caddy"
          - "run"
          - "--config"
          - "/etc/caddy/Caddyfile"
      volumes:
      - name: caddy-config
        configMap:
          name: caddy-config
